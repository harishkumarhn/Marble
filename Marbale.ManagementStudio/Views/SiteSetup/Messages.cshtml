@{
    ViewBag.Title = "Messages";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div>
    <label id="successMessages" class="pos-text"></label>
</div>
<div>
<table id="messagesTable" class="table messagesTable table-bordered" style="display: block; height: 500px; overflow-x: auto">  
        <thead>  
            <th >MessageNo</th>  
            <th>Message</th>    
        </thead>  
        @foreach (var item in ViewBag.Messages)  
        {  
            <tr onchange="UpdatedList(this)"> 
        <td style="padding:0"> @item.MessageNo  </td>    
        <td style="padding:0"> 
                @if (@item.MessageNo % 2 != 0)
                {
                <input type="text" value="@item.MessageDescription" class="gridText" style="width: 88vw;background-color:antiquewhite">
                }
                else
                {
                    <input type="text" value="@item.MessageDescription" class="gridText" style="width: 88vw;">
                }
        </td>
    </tr>  
        }  
    </table>
    <button class="btn btn-primary btn-md" role="button" onclick="addMessage()">New</button> 
    <button class="btn btn-primary btn-md" role="button" onclick="SaveMeesages()">Save</button>  
    <a href="/Product/ClosePopUp" class="btn btn-primary">Close</a>  
    <button class="btn btn-primary btn-md" role="button" onclick="event.preventDefault(); history.back();" id="back">Back</button>     
</div>
<style>
    .back-color {
        background-color:blueviolet;
    }
    .pos-text {
           left: 650px;
    position: absolute;
    top: 135px;
        color: blue;
    }
</style>
     <script>
         function SaveMeesages() {
             var messageObject = [];
             var table = document.getElementById('messagesTable');
             for (var r = 1, n = table.rows.length; r < n; r++) {
                 if (updatedArray.includes(r)) {
                     messageObject.push({
                         MessageNo: table.rows[r].cells[0].innerHTML,
                         MessageDescription: table.rows[r].cells[1].children[0].value,
                         MessageName: "",                    
                     });
                 }
             }
             $.ajax({
                 type: "POST",
                 contentType: "application/json; charset=utf-8",
                 url: '@Url.Action("UpdateMessages", "SiteSetup")',
                 data: JSON.stringify({ messageObject: messageObject }),
            dataType: "json",
            success: function (data) {
                $('#successMessages').text('Data Saved Successfully');
                window.location.reload();
            },
            error: function (e) {              
                alert(e);
            }
        });
    }
         var updatedArray = [];
         function UpdatedList(x) {
             if (!updatedArray.includes(x.rowIndex)) {
                 updatedArray.push(x.rowIndex);
             }
         }

         function addMessage() {
             var table = document.getElementById('messagesTable');
             table.getElementsByTagName('tbody')[0].innerHTML += "<tr onchange='UpdatedList(this)'><td ></td><td> <input type='text' class='gridText' style='width: 100vw;'>  </td></tr>"
             table.scrollBy({
                 top: table.offsetHeight,
                 behavior: 'smooth'
             });
         }
     </script>    